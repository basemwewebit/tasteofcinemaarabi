# Tasks: Cinema CMS Foundation

**Input**: Design documents from `/specs/001-cinema-cms/`
**Prerequisites**: plan.md (required), spec.md (required for user stories), research.md, data-model.md, contracts/api.md, quickstart.md

**Organization**: Tasks are grouped by user story to enable independent implementation and testing of each story.
**Agent Integration**: Utilizing specialists (`frontend-specialist`, `backend-specialist`, etc.) and defined skills (`nextjs-react-expert`, `database-design`, etc.) according to `.agent/` resources.

## Phase 1: Setup (Shared Infrastructure)

**Purpose**: Project initialization and basic structure

- [x] T001 Initialize Next.js 15 App Router project with TypeScript (`backend-specialist` + `app-builder`)
- [x] T002 Configure RTL support in `src/app/layout.tsx` (`frontend-specialist` + `frontend-design`)
- [x] T003 [P] Set up CSS Modules, custom properties, and fonts in `src/styles/` (`frontend-specialist` + `frontend-design`)
- [x] T004 Install required dependencies (`better-sqlite3`, `cheerio`, `openai`, `lucide-react`, `next-mdx-remote`)
- [x] T005 [P] Setup SQLite connection and run `setup-db.ts` to create `cinema.db` (`backend-specialist` + `database-design`)

---

## Phase 2: Foundational (Blocking Prerequisites)

**Purpose**: Core infrastructure that MUST be complete before ANY user story can be implemented

**‚ö†Ô∏è CRITICAL**: No user story work can begin until this phase is complete

- [x] T006 Implement database schema execution script in `scripts/setup-db.ts`
- [x] T007 [P] Create base SQLite queries and connection singleton in `src/lib/db/index.ts` (`database-design`)
- [x] T008 [P] Configure OpenAI API client in `src/lib/ai/translate.ts` (`backend-specialist`)
- [x] T009 Create MDX processing utilities in `src/lib/content/mdx.ts`
- [x] T010 [P] Define TypeScript interfaces in `src/types/` (`article.ts`, `api.ts`, etc.)

**Checkpoint**: Foundation ready - user story implementation can now begin.

---

## Phase 3: User Story 1 - AI Article Translation Pipeline (Priority: P1) üéØ MVP

**Goal**: As an Editor, I want to paste a URL from tasteofcinema.com so that the system automatically scrapes, translates to Arabic using AI, and saves it as a draft Markdown file with SQLite metadata.

**Independent Test**: Can be fully tested by providing a URL to the API and verifying that a translated MDX file is generated with correct frontmatter and a corresponding SQLite record is created.

### Tests for User Story 1

- [x] T011 [P] [US1] Create unit test for scraper DOM parsing (`tests/lib/scraper.test.ts`)
- [x] T012 [P] [US1] Create mock integration test for OpenAI translation pipeline (`tests/lib/ai/translate.test.ts`)

### Implementation for User Story 1

- [x] T013 [P] [US1] Implement Taste of Cinema specific HTML scraper in `src/lib/scraper/tasteofcinema.ts` (`backend-specialist`)
- [x] T014 [P] [US1] Implement `saveArticleMetadata` query in `src/lib/db/articles.ts`
- [x] T015 [US1] Create `POST /api/scrape` endpoint in `src/app/api/scrape/route.ts` (depends on T013)
- [x] T016 [US1] Create `POST /api/translate` endpoint combining scraper, GPT-4o, and MDX generation (depends on T014, T015)
- [x] T017 [US1] Add pagination handling inside the scraper logic to ensure full article ingestion

**Checkpoint**: At this point, User Story 1 should be fully functional and testable independently via API calls.

---

## Phase 4: User Story 2 - Cinematic Editorial Reading Experience (Priority: P1)

**Goal**: As an Arabic Reader, I want to read cinema articles in a premium, RTL-first, typography-focused design so that I enjoy a luxury magazine-like experience without standard blog clich√©s.

**Independent Test**: Can be fully tested by navigating the site's homepage and article pages across different devices and toggling dark/light modes.

### Implementation for User Story 2

- [x] T018 [P] [US2] Implement global CSS tokens, Noir & Gold palette, and typography in `src/styles/` (`frontend-specialist`)
- [x] T019 [P] [US2] Create base UI components (`Card`, `Button`, `Badge`) without Tailwind (`frontend-design` + `clean-code`)
- [x] T020 [US2] Build `Header` and `Footer` components with source attribution requirements (`frontend-specialist`)
- [x] T021 [US2] Implement the Homepage Layout `src/app/(site)/page.tsx` with editorial overlapping structure (`frontend-specialist`)
- [x] T022 [US2] Build Single Article Page `src/app/(site)/article/[slug]/page.tsx` displaying MDX content (`nextjs-react-expert`)
- [x] T023 [US2] Build reusable AdSense structural placeholders `src/components/ads/AdSlot.tsx` to prevent CLS
- [x] T024 [US2] Integrate the AdSlot placeholders into Homepage and Article Layouts

**Checkpoint**: At this point, User Stories 1 AND 2 should both work independently. The frontend should display articles generated by the pipeline.

---

## Phase 5: User Story 3 - Admin Content Management (Priority: P2)

**Goal**: As an Admin, I want to manage articles, moderate comments, and initiate batch imports so that I can control the platform's content and track AI processing progress.

**Independent Test**: Can be tested by logging into the admin panel, creating/editing an article, and triggering a batch import process.

### Implementation for User Story 3

- [x] T025 [P] [US3] Create `src/app/(admin)/layout.tsx` for the admin dashboard interface (`frontend-specialist`)
- [x] T026 [P] [US3] Implement `GET /api/articles` and `DELETE /api/articles/[id]` backend routes (`backend-specialist`)
- [x] T027 [US3] Build Article Management table view in `src/app/(admin)/articles/page.tsx`
- [x] T028 [US3] Create MDX editor interface for admins in `src/app/(admin)/articles/[id]/edit/page.tsx`
- [x] T029 [US3] Implement `POST /api/import-batch` route for bulk translation processing (`backend-specialist` + `nodejs-best-practices`)
- [x] T030 [US3] Build Admin Batch Import progress UI in `src/app/(admin)/import/page.tsx`

**Checkpoint**: All user stories should now be independently functional. Admin can process multiple URLs and view them on the public site.

---

## Phase N: Polish & Cross-Cutting Concerns

**Purpose**: Improvements that affect multiple user stories

- [x] T031 [P] Ensure all Lighthouse scores are ‚â• 90 (`performance-profiling` + `seo-fundamentals`)
- [x] T032 Verify SQLite FTS5 Arabic search functionality across the site
- [x] T033 Apply final responsive design tweaks for 375px screens
- [x] T034 [P] Final code review against `code-review-checklist.md` rules
- [x] T035 Run `checklist.py` pre-deploy suite

---

## Dependencies & Execution Order

### Phase Dependencies

- **Setup (Phase 1)**: No dependencies - can start immediately
- **Foundational (Phase 2)**: Depends on Phase 1 - BLOCKS all user stories
- **US1 & US2 (Phase 3 & 4)**: Can proceed in parallel after Phase 2 (P1 priority).
- **US3 (Phase 5)**: Depends on US1 completion (needs pipeline backend to exist) and US2 (needs frontend components).
- **Polish**: Depends on all user stories completion.

### Parallel Opportunities

- CSS/Design implementation (US2) can happen simultaneously with backend Scraping logic (US1).
- Setting up Admin routing structure (US3) can start while US2 frontend polish is happening.

### Implementation Strategy

1. **MVP First**: Complete Phase 1 & 2 ‚Üí Build US1 (Pipeline) ‚Üí Build US2 (Frontend). This delivers the core value.
2. **Admin Scaling**: Deploy US3 (Admin/Batch) to streamline content creation post-MVP.
