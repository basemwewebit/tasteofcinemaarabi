# Feature Specification: تحسين جودة الترجمة — مستوى مكتب ترجمة معتمد

**Feature Branch**: `007-certified-translation-quality`  
**Created**: 2026-02-28  
**Status**: Draft  
**Input**: User description: "تحسين جودة الترجمة لتكون كترجمة صادرة عن مكتب ترجمة معتمد ذو جودة فائقة — يتصرف كمكتب ترجمة قانوني"

## Clarifications

### Session 2026-02-28

- Q: هل يشمل التحسين إعادة ترجمة المقالات القديمة أم المقالات الجديدة فقط؟ → A: المقالات الجديدة تُترجم تلقائياً بالنظام المحسّن، مع إمكانية إعادة ترجمة أي مقال قديم يدوياً عند الحاجة.
- Q: أين يُخزّن القاموس المصطلحي (Glossary)؟ → A: ملف JSON/YAML ثابت في مستودع الكود (version-controlled).
- Q: ما مستوى تفصيل تقرير جودة الترجمة وأين يُعرض؟ → A: ملخص مختصر في لوحة الإدارة (عدد التصحيحات + مصطلحات جديدة + حالة كل مرحلة).
- Q: ما حد تقسيم المقالات الطويلة؟ → A: 30,000 حرف لكل جزء (توازن بين السياق والتكلفة).
- Q: هل تُنفذ المراجعة والتدقيق كاستدعاءين منفصلين أم مدمجين؟ → A: 3 استدعاءات منفصلة (ترجمة + مراجعة + تدقيق) لمراقبة كاملة لكل مرحلة.

## User Scenarios & Testing *(mandatory)*

<!--
  IMPORTANT: User stories should be PRIORITIZED as user journeys ordered by importance.
  Each user story/journey must be INDEPENDENTLY TESTABLE - meaning if you implement just ONE of them,
  you should still have a viable MVP (Minimum Viable Product) that delivers value.
  
  Assign priorities (P1, P2, P3, etc.) to each story, where P1 is the most critical.
  Think of each story as a standalone slice of functionality that can be:
  - Developed independently
  - Tested independently
  - Deployed independently
  - Demonstrated to users independently
-->

### User Story 1 - ترجمة مقال سينمائي بجودة مكتب ترجمة معتمد (Priority: P1)

مدير المحتوى يُطلق ترجمة مقال سينمائي إنجليزي. يقوم النظام بتنفيذ ترجمة احترافية متعددة المراحل: ترجمة أولية، ثم مراجعة لغوية وأسلوبية، ثم تدقيق نهائي — كما يفعل مكتب ترجمة معتمد. النص الناتج يقرأه القارئ العربي وكأنه كُتب أصلاً بالعربية، بأسلوب صحفي أدبي رفيع يليق بمجلة سينمائية متخصصة.

**Why this priority**: هذه هي الميزة الجوهرية — تحويل الترجمة من ناتج آلي بسيط إلى منتج احترافي يضاهي مخرجات مكاتب الترجمة المعتمدة. بدون هذا التحسين، يبقى المحتوى بمستوى ترجمة آلية يُنفّر القارئ.

**Independent Test**: يمكن اختباره بترجمة مقال واحد ومقارنة الناتج الجديد بالناتج القديم من حيث: سلاسة النص، صحة القواعد النحوية، غياب التراكيب الحرفية، وملاءمة الأسلوب للسياق السينمائي.

**Acceptance Scenarios**:

1. **Given** مقال إنجليزي عن أفلام الجريمة والإثارة يحتوي على 3000 كلمة، **When** يُطلق المستخدم عملية الترجمة، **Then** ينتج النظام نصاً عربياً بأسلوب صحفي أدبي خالٍ من التراكيب الحرفية المترجمة، مع الحفاظ على أسماء الأفلام بلغتها الأصلية.
2. **Given** مقال يحتوي على مصطلحات سينمائية متخصصة (مثل: film noir, mise-en-scène, montage)، **When** تتم الترجمة، **Then** تُستخدم المقابلات العربية المعتمدة في النقد السينمائي العربي (مثل: الفيلم الأسود، التكوين البصري، المونتاج) بشكل متسق.
3. **Given** مقال مترجم بالنظام الجديد، **When** يُقرأ بمعزل عن الأصل الإنجليزي، **Then** لا يستطيع القارئ العربي المتخصص تمييز أنه نص مترجم (يبدو وكأنه كُتب أصلاً بالعربية).

---

### User Story 2 - قاموس مصطلحات سينمائية موحّد (Priority: P2)

النظام يحتفظ بقاموس مصطلحات سينمائية مرجعي (glossary) يضمن ترجمة كل مصطلح بنفس المقابل العربي المعتمد في جميع المقالات. هذا القاموس يشمل: مصطلحات نقدية سينمائية، أنواع الأفلام (genres)، مصطلحات صناعة السينما، وأسماء الحركات السينمائية.

**Why this priority**: الاتساق المصطلحي هو ما يميز الترجمة المهنية عن الهاوية. قارئ يتنقل بين مقالات الموقع يجب أن يجد نفس المصطلح مترجَماً بنفس الطريقة دائماً.

**Independent Test**: يمكن اختباره بترجمة مقالين يحتويان على نفس المصطلحات السينمائية والتحقق من أن الترجمة متسقة بينهما.

**Acceptance Scenarios**:

1. **Given** مقالان يحتويان على مصطلح "film noir"، **When** يُترجم كلا المقالين، **Then** يظهر نفس المقابل العربي ("الفيلم الأسود" أو "سينما نوار") في كليهما.
2. **Given** مصطلح جديد لا يوجد في القاموس، **When** تتم ترجمته لأول مرة، **Then** يُضاف تلقائياً إلى القاموس المرجعي ليُستخدم في الترجمات اللاحقة.

---

### User Story 3 - مراجعة ذاتية وتصحيح تلقائي للترجمة (Priority: P2)

بعد الترجمة الأولية، يقوم النظام تلقائياً بمراجعة ذاتية تشمل: فحص القواعد النحوية والصرفية، اكتشاف التراكيب الحرفية المترجمة من الإنجليزية، التحقق من سلاسة الربط بين الجمل، ومراجعة اتساق المصطلحات. ثم يُصحح المشكلات المكتشفة تلقائياً قبل إنتاج النسخة النهائية.

**Why this priority**: مكاتب الترجمة المعتمدة لا تُسلّم ترجمة من مرور واحد أبداً. دورة المراجعة والتصحيح هي ما يرفع الجودة من "مقبول" إلى "ممتاز".

**Independent Test**: يمكن اختباره بمقارنة مخرجات المرحلة الأولى (الترجمة الخام) مع المخرجات النهائية بعد المراجعة، والتحقق من إصلاح أخطاء محددة.

**Acceptance Scenarios**:

1. **Given** ترجمة أولية تحتوي على تراكيب إنجليزية حرفية (مثل: "في نهاية اليوم" بدلاً من "في نهاية المطاف")، **When** تُجرى المراجعة الذاتية، **Then** تُستبدل التراكيب الحرفية ببدائل عربية طبيعية.
2. **Given** ترجمة أولية يوجد فيها خطأ في إعراب كلمة أو عدم مطابقة بين المبتدأ والخبر، **When** تُجرى المراجعة، **Then** يُصحح الخطأ النحوي.
3. **Given** مقال طويل (أكثر من 5000 كلمة)، **When** تتم الترجمة مع المراجعة، **Then** يبقى الأسلوب والنبرة متسقين من أول المقال إلى آخره.

---

### User Story 4 - دليل أسلوب تحريري للمحتوى السينمائي (Priority: P3)

النظام يتبع دليل أسلوب تحريري واضح يحدد: نبرة الكتابة (أدبية صحفية متخصصة)، مستوى اللغة (فصحى معاصرة بدون تقعّر)، أسلوب المخاطبة (غير مباشر، بصيغة الجمع)، وقواعد التعامل مع الأسماء الأجنبية والاقتباسات والأرقام.

**Why this priority**: دليل الأسلوب يضمن هوية تحريرية موحدة للموقع. هو مهم لكنه يعتمد على وجود البنية التحتية للترجمة المحسّنة أولاً.

**Independent Test**: يمكن اختباره بترجمة 5 مقالات مختلفة والتحقق من أن جميعها تتبع نفس النبرة والأسلوب التحريري.

**Acceptance Scenarios**:

1. **Given** مقال يحتوي على اقتباسات مباشرة من مخرج سينمائي، **When** تتم الترجمة، **Then** تُترجم الاقتباسات بأسلوب يحافظ على روح المتحدث مع الإشارة إلى أنها مترجمة.
2. **Given** مقال يحتوي على أرقام وتواريخ (سنوات إنتاج، ميزانيات، إيرادات)، **When** تتم الترجمة، **Then** تُعرض الأرقام بالأرقام الهندية-العربية (٠١٢٣) والتواريخ بالتنسيق العربي.

---

### Edge Cases

- ما الذي يحدث عندما يكون المقال مكتوباً بأسلوب عامي أو غير رسمي بالإنجليزية؟ يجب أن يُترجم بأسلوب فصيح لكن بنبرة تحافظ على خفة الأصل دون السقوط في العامية.
- كيف يتعامل النظام مع مقال يحتوي على مصطلحات سينمائية ليس لها مقابل عربي متفق عليه؟ يُستخدم المصطلح الأجنبي كما هو مع شرح مختصر بالعربية عند أول ظهور.
- ما الذي يحدث عندما يتعارض القاموس المصطلحي مع السياق المحدد للمقال؟ يُقدَّم السياق على القاموس مع تسجيل الاستثناء.
- كيف يتعامل النظام مع المقالات الطويلة جداً التي تتجاوز حدود النموذج اللغوي؟ يُقسّم المقال إلى أجزاء منطقية عند فواصل طبيعية (عناوين فرعية أو فقرات) مع الحفاظ على اتساق الأسلوب والمصطلحات بين الأجزاء.
- كيف يتعامل النظام مع نص يخلط بين لغات متعددة (إنجليزي، فرنسي، إيطالي) كما في مقالات السينما الأوروبية؟ تُحافظ الأسماء والمصطلحات بلغتها الأصلية مع تقديم المقابل العربي عند الحاجة.
- ما الذي يحدث عندما يفشل أحد مراحل المراجعة؟ يُعاد المحاولة مرة واحدة، فإن فشلت يُسلَّم ناتج المرحلة السابقة الناجحة مع تنبيه المستخدم بأن المراجعة لم تكتمل.
- كيف يتعامل النظام مع نص يحتوي على اتجاه مختلط (عربي وإنجليزي) لضمان عرض سليم؟ تُعزل العناصر الأجنبية المُضمنة بعلامات اتجاه ثنائية لضمان عرض صحيح من اليمين لليسار.

## Requirements *(mandatory)*

### Functional Requirements

#### منظومة الترجمة متعددة المراحل

- **FR-001**: النظام يجب أن ينفّذ الترجمة على ثلاث مراحل متتالية، كل مرحلة باستدعاء منفصل للنموذج اللغوي (3 استدعاءات إجمالاً):
  1. **ترجمة أولية**: ترجمة النص الكامل مع تعليمات مُفصّلة عن الأسلوب والنبرة
  2. **مراجعة لغوية**: فحص الناتج بحثاً عن: أخطاء نحوية، تراكيب حرفية، مصطلحات غير متسقة، جمل ملتبسة
  3. **تدقيق نهائي**: تنقيح أخير للسلاسة والاتساق وجودة الربط بين الفقرات

- **FR-002**: النظام يجب أن يوفر تعليمات ترجمة احترافية مفصلة تشمل:
  - تعريف واضح للدور: "مكتب ترجمة معتمد متخصص في المحتوى السينمائي والثقافي"
  - نبرة الترجمة: صحفية أدبية رفيعة تليق بمجلة سينمائية متخصصة
  - قواعد نحوية صارمة: فصحى معاصرة بدون تقعّر ولا عامية
  - تعليمات صريحة بتجنب الترجمة الحرفية وإعادة صياغة الجمل بما يناسب البنية العربية

- **FR-003**: النظام يجب أن يتعامل مع كل مرحلة بصفتها عملية مستقلة لها مدخلاتها ومخرجاتها المحددة، بحيث يمكن مراقبة جودة كل مرحلة على حدة.

#### القاموس المصطلحي الموحّد

- **FR-004**: النظام يجب أن يحتفظ بقاموس مصطلحات سينمائية مرجعي مُخزّن كملف JSON/YAML ثابت في مستودع الكود (يُتتبع بـ Git) يحتوي على:
  - المصطلح الإنجليزي
  - المقابل العربي المعتمد
  - سياق الاستخدام (اختياري)
  
- **FR-005**: النظام يجب أن يُدرج المصطلحات المعتمدة من القاموس ضمن تعليمات الترجمة لضمان الاتساق.

- **FR-006**: النظام يجب أن يُحدّث القاموس بالمصطلحات الجديدة المُكتشفة أثناء الترجمة، مع مراجعة بشرية اختيارية قبل الاعتماد.

#### دليل الأسلوب التحريري

- **FR-007**: النظام يجب أن يتبع دليل أسلوب مُحدد يشمل:
  - **النبرة**: صحفية أدبية متخصصة (كمجلة سينمائية ورقية راقية)
  - **المستوى اللغوي**: فصحى معاصرة — وسط بين اللغة الأكاديمية الجامدة والأسلوب الشعبي المبسّط
  - **أسماء الأفلام**: تبقى بلغتها الأصلية كما هي
  - **أسماء المخرجين والممثلين**: تبقى بلغتها الأصلية (لا تعريب صوتي)
  - **الاقتباسات**: تُترجم مع حفظ روح المتحدث وتُوضع بين علامات تنصيص عربية « »
  - **الأرقام**: تُكتب بالأرقام الهندية-العربية (١، ٢، ٣...)
  - **التراكيب المحظورة**: تُرفض التراكيب الحرفية المنقولة من الإنجليزية (مثل: "لعب دوراً" بدلاً من "أدّى دوراً"، "في نهاية اليوم" بدلاً من "في خاتمة المطاف")

- **FR-008**: النظام يجب أن يتضمن قائمة بالتراكيب الحرفية الشائعة المحظورة مع بدائلها العربية الصحيحة، وتُقدَّم هذه القائمة ضمن تعليمات المراجعة اللغوية.

#### معالجة المقالات الطويلة

- **FR-009**: النظام يجب أن يُقسّم المقالات التي تتجاوز 30,000 حرف إلى أجزاء منطقية عند فواصل طبيعية (عناوين فرعية، فواصل بين عناصر القوائم)، ويترجم كل جزء مع سياق مشترك يضمن اتساق الأسلوب والمصطلحات.

- **FR-010**: النظام يجب ألا يبتر أي محتوى بصمت. إذا تجاوز المقال حدود المعالجة، يجب إخطار المستخدم وتقسيم المحتوى بدلاً من إسقاط جزء منه.

#### عزل الاتجاه الثنائي (Bidi Isolation)

- **FR-011**: النظام يجب أن يعزل العناصر الأجنبية المُضمنة في النص العربي (أسماء أفلام، مصطلحات إنجليزية) بعلامات اتجاه ثنائية مناسبة لضمان عرض صحيح من اليمين لليسار.

#### نطاق التطبيق (إعادة الترجمة)

- **FR-012**: النظام يجب أن يُطبق منهجية الترجمة المحسّنة تلقائياً على جميع المقالات الجديدة. المقالات المترجمة سابقاً يمكن إعادة ترجمتها يدوياً عند الطلب باستخدام نفس المنهجية المحسّنة.

#### تقرير جودة الترجمة

- **FR-013**: النظام يجب أن يُعرض ملخصاً مختصراً لتقرير جودة الترجمة في لوحة إدارة المحتوى يشمل:
  - حالة كل مرحلة (نجحت / فشلت)
  - عدد التصحيحات المُجراة في كل مرحلة
  - المصطلحات الجديدة المُكتشفة (إن وجدت)

### Key Entities

- **قاموس المصطلحات (Glossary)**: ملف JSON/YAML ثابت في مستودع الكود يحتوي على مصطلحات سينمائية مع مقابلاتها العربية المعتمدة. لكل مصطلح: المصطلح الأصلي، المقابل العربي، سياق الاستخدام، تاريخ الإضافة. يُتتبع بـ Git مما يسمح بمراجعة التغييرات والتراجع عنها.
- **دليل الأسلوب (Style Guide)**: مجموعة من القواعد التحريرية التي تحكم نبرة الترجمة ومستواها اللغوي وأسلوب التعامل مع العناصر الخاصة (أسماء، اقتباسات، أرقام).
- **قائمة التراكيب المحظورة (Banned Patterns)**: تراكيب إنجليزية حرفية شائعة في الترجمة الآلية مع بدائلها العربية الطبيعية.
- **تقرير جودة الترجمة (Quality Report)**: ملخص مختصر يُعرض في لوحة إدارة المحتوى يوثّق حالة كل مرحلة من مراحل الترجمة، عدد التصحيحات، والمصطلحات الجديدة المُكتشفة.

## Assumptions

- الموقع يستخدم حالياً OpenRouter مع نموذج GPT-4o للترجمة، والتحسينات ستُبنى فوق هذه البنية التحتية القائمة.
- المنهجية متعددة المراحل ستتطلب 3 استدعاءات منفصلة للنموذج اللغوي (ترجمة + مراجعة + تدقيق) بدلاً من استدعاء واحد، مما يزيد التكلفة والوقت بمقدار 3 أضعاف — وهذا مقبول مقابل تحسّن الجودة والشفافية في مراقبة كل مرحلة.
- القاموس المصطلحي سيبدأ بمجموعة أساسية من المصطلحات السينمائية الشائعة ويتوسع تلقائياً مع كل ترجمة جديدة.
- دليل الأسلوب التحريري مستوحى من أسلوب المجلات السينمائية العربية الرائدة (مثل مجلة "الفن السابع" ومجلة "سينماتيك").
- أسماء الأفلام والمخرجين والممثلين تبقى بلغتها الأصلية كما هو السلوك الحالي في النظام.
- الأرقام ستُعرض بالأرقام الهندية-العربية (١٢٣) وهو المعيار في الصحافة العربية الرسمية.
- التحسينات تُطبق تلقائياً على المقالات الجديدة فقط. المقالات القديمة يمكن إعادة ترجمتها يدوياً عند الحاجة — لا توجد عملية إعادة ترجمة جماعية تلقائية.

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 90% من المقالات المترجمة بالنظام الجديد لا يتعرف فيها مراجع بشري مختص على أنها ترجمة آلية (تبدو مكتوبة أصلاً بالعربية).
- **SC-002**: 100% من المصطلحات السينمائية المتكررة تُترجم بنفس المقابل العربي عبر جميع مقالات الموقع.
- **SC-003**: 0% من المقالات تحتوي على تراكيب حرفية مترجمة من القائمة المحظورة في النسخة النهائية.
- **SC-004**: لا يُبتر أي محتوى بصمت — 100% من المقالات تُترجم بالكامل بغض النظر عن طولها.
- **SC-005**: يستطيع مدير المحتوى مراجعة تقرير جودة الترجمة لكل مقال خلال 30 ثانية من اكتمال الترجمة.
- **SC-006**: النص المترجم يُعرض بشكل سليم من اليمين لليسار دون أخطاء في اتجاه النص المختلط (عربي/إنجليزي).
